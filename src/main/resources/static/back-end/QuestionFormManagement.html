<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">

<!-- 標題 -->
<title>TirpLight後台</title>

<!-- 自訂字型 -->
<link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet"
	type="text/css">
<link href="botcss/bootstrap.min.css" rel="stylesheet" type="text/css">
<link
	href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
	rel="stylesheet">

<script src="js/jquery-3.7.0.min.js"></script>
<link rel="stylesheet" href="css/sweetalert2.min.css">
<script src="js/sweetalert2.min.js"></script>
<script src="js/login.js"></script>
<!-- 自訂樣式 -->
<link href="css/TripLight.min.css" rel="stylesheet">
<link href="vendor/datatables/dataTables.bootstrap4.min.css"
	rel="stylesheet">
<style>
.text-overflow {
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	max-width: 800px;
	/* 你可以根據需要調整這個值 */
	
	
}

#employee-access {
	white-space: pre-line;
	}
</style>
</head>

<body id="page-top" style="overflow-y: scroll;">
	<!-- 頁面包裹區域 -->
	<div id="wrapper">

		<!-- 側邊欄 -->
		<ul
			class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion"
			id="accordionSidebar">
			<!-- 側邊欄 - 品牌 -->
			<a
				class="sidebar-brand d-flex align-items-center justify-content-center"
				href="index.html"> <img src="img/icon.png" alt="Icon"
				class="sidebar-brand-icon rotate-n-15"
				style="width: 30px; height: 30px;">
				<div class="sidebar-brand-text mx-3">後台</div>
			</a>


			<!-- 導覽項目 -  -->
			<li class="nav-item active"><a class="nav-link"
				href="http://localhost:8080/front-end/index.html"> <span>TirpLight</span></a></li>
			<!-- 導覽項目 - 頁面折疊選單 -->
			<li class="nav-item"><a class="nav-link collapsed" href="#"
				data-toggle="collapse" data-target="#collapseTwo"
				aria-expanded="true" aria-controls="collapseTwo"> <span>員工管理</span>
			</a>
				<div id="collapseTwo" class="collapse" aria-labelledby="headingTwo"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<a class="collapse-item" href="EmployeeQuety.html">查詢資料</a> <a
							class="collapse-item" href="EmployeeRevise.html">新增資料</a>
					</div>
				</div></li>

			<!-- 導覽項目 - 公用程式折疊選單 -->
			<li class="nav-item"><a class="nav-link collapsed" href="#"
				data-toggle="collapse" data-target="#collapseUtilities"
				aria-expanded="true" aria-controls="collapseUtilities"> <span>會員管理</span>
			</a>
				<div id="collapseUtilities" class="collapse"
					aria-labelledby="headingUtilities" data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<a class="collapse-item" href="MemberQuety.html">查詢資料</a>
					</div>
				</div></li>


			<!-- 功能頁面 -->
			<li class="nav-item"><a class="nav-link collapsed" href="#"
				data-toggle="collapse" data-target="#collapsePages"
				aria-expanded="true" aria-controls="collapsePages"> <span>廠商管理</span>
			</a>
				<div id="collapsePages" class="collapse"
					aria-labelledby="headingPages" data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<a class="collapse-item" href="FirmInert.html">廠商資料</a> <a
							class="collapse-item" href="FirmRevise.html">行程管理</a> <a
							class="collapse-item" href="FirmReport.html">檢舉廠商</a>
					</div>
				</div></li>

			<li class="nav-item"><a class="nav-link collapsed" href="#"
				data-toggle="collapse" data-target="#collapseTickets"
				aria-expanded="true" aria-controls="collapseTickets"> <span>票卷管理</span>
			</a>
				<div id="collapseTickets" class="collapse"
					aria-labelledby="headingTickets" data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<a class="collapse-item" href="TicketManagement.html">票卷資料管理</a> <a
							class="collapse-item" href="TicketOrderManagement.html">票卷訂單管理</a>
						<a class="collapse-item" href="TicketPromotionManagement.html">票卷促銷管理</a>
						<a class="collapse-item" href="TicketSalesAnalysis.html">銷售分析</a>
					</div>
				</div></li>

			<li class="nav-item"><a class="nav-link collapsed" href="#"
				data-toggle="collapse" data-target="#collapseWebManagement"
				aria-expanded="true" aria-controls="collapseWebManagement"> <span>網頁管理</span>
			</a>
				<div id="collapseWebManagement" class="collapse"
					aria-labelledby="headingWebManagement"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<a class="collapse-item" href="TravelArticles.html">文章管理</a> <a
							class="collapse-item" href="ReportAriocles.html">檢舉管理</a>
					</div>
				</div></li>



			<li class="nav-item"><a class="nav-link collapsed" href="#"
				data-toggle="collapse" data-target="#collapseCustomerService"
				aria-expanded="true" aria-controls="collapseCustomerService"> <span>客服中心</span>
			</a>
				<div id="collapseCustomerService" class="collapse"
					aria-labelledby="headingCustomerService"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<a class="collapse-item" href="QuestionFormManagement.html">問題表單管理</a>
						<a class="collapse-item" href="CustomerServiceChatManagement.html">客服聊天管理</a>
					</div>
				</div></li>


			<!-- 側邊欄切換器（側邊欄） -->
			<!-- <div class="text-center d-none d-md-inline">
            <button class="rounded-circle border-0" id="sidebarToggle"></button>
        </div> -->
		</ul>
		<!-- 側邊導覽列結束 -->


		<!-- 內容包裹區域 -->
		<div id="content-wrapper" class="d-flex flex-column">

			<!-- 主要內容 -->
			<div id="content">

				<!-- 上導覽列 -->
				<nav
					class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

					<!-- 側邊欄開關按鈕 -->
					<button id="sidebarToggleTop"
						class="btn btn-link d-md-none rounded-circle mr-3">
						<i class="fa fa-bars"></i>
					</button>

					<!-- 上導覽列導覽選單 -->
					<ul class="navbar-nav ml-auto">
						<li class="nav-item dropdown no-arrow"><a
							class="nav-link dropdown-toggle" href="#" id="userDropdown"
							role="button" data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="false"> <span
								class="mr-2 d-none d-lg-inline text-gray-600 small"
								id="employee-access"></span> <i class="fas fa-user-circle fa-lg"></i>
						</a> <!-- 下拉選單 - 使用者資訊 -->
							<div
								class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
								aria-labelledby="userDropdown" id="logoutLink">
								<a class="dropdown-item" href=""> 登出 </a>
							</div></li>
					</ul>
				</nav>

				<div class="card-body">
					<h3 class="m-0 font-weight-bold text-primary">問題回報處理中心</h3>
					<div class="card-body">
						<div class="table-responsive">
							<table class="table table-bordered" width="100%" cellspacing="0">
								<thead>
									<tr>
										<th width="10%">訂單編號</th>
										<th style="width: 800px;" class="text-overflow">問題內容</th>
										<th width="15%">發問時間</th>
										<th width="10%">問題狀態</th>
										<th></th>
									</tr>
								</thead>
								<tbody class="question-data">
								</tbody>
							</table>
						</div>
					</div>
				</div>


				<script src="vendor/jquery/jquery.min.js"></script>
				<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

				<!-- 核心插件 JavaScript -->
				<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

				<!-- 自訂腳本，適用於所有頁面 -->
				<script src="js/TripLight-2.min.js"></script>

				<!-- 頁面級別的插件 -->
				<script src="vendor/chart.js/Chart.min.js"></script>

				<!-- 頁面級別的自訂腳本 -->
				<script src="js/demo/chart-area-demo.js"></script>
				<script src="js/demo/chart-pie-demo.js"></script>


				<!--引入datables-->
				<script src="vendor/datatables/jquery.dataTables.min.js"></script>
				<script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>
				<script src="js/demo/datatables-demo.js"></script>
			</div>
		</div>
	</div>
</body>
<script>
var employeeAccess = sessionStorage.getItem("管理員");
var employeeaccess2 = JSON.parse(employeeAccess);
	        
  $("#employee-access")
	   .text("員工:"+employeeaccess2.employeeName +	 "\n" 
	+ "權限:"+employeeaccess2.employeeAccess);

// 根據帳限顯示導覽
  if (employeeaccess2.employeeAccess === "超級管理員") {
	  
  } else if (employeeaccess2.employeeAccess === "員工管理員") {
      $("#member-management").hide();
      $("#firm-management").hide();
      $("#ticket-management").hide();
      $("#web-management").hide();
      $("#customer-service").hide();
  } else if (employeeaccess2.employeeAccess === "會員管理員") {
      $("#employee-management").hide();
      $("#firm-management").hide();
      $("#ticket-management").hide();
      $("#web-management").hide();
      $("#customer-service").hide();
  } else if (employeeaccess2.employeeAccess === "廠商管理員") {
      $("#employee-management").hide();
      $("#member-management").hide();
      $("#ticket-management").hide();
      $("#web-management").hide();
      $("#customer-service").hide();
  } else if (employeeaccess2.employeeAccess === "票卷管理員") {
      $("#employee-management").hide();
      $("#member-management").hide();
      $("#firm-management").hide();
      $("#web-management").hide();
      $("#customer-service").hide();
  } else if (employeeaccess2.employeeAccess === "網頁管理員") {
      $("#employee-management").hide();
      $("#member-management").hide();
      $("#firm-management").hide();
      $("#ticket-management").hide();
      $("#customer-service").hide();
  } else if (employeeaccess2.employeeAccess === "客服管理員") {
      $("#employee-management").hide();
      $("#member-management").hide();
      $("#firm-management").hide();
      $("#ticket-management").hide();
      $("#web-management").hide();
  }




$("#logoutLink").click(function () {
	 $.ajax({
type: "GET",
	 url: "/BKlogout", 
	 success: function () {
window.location.href = "http://localhost:8080/back-end/login.html";
  },
error: function () {
   		}
	});
	});

	let loginData = JSON.parse(sessionStorage.getItem('管理員'));
	let employeeId = loginData.employeeId;
	console.log(employeeId)
    // let employeeId = 3;

    $("#logoutLink").click(function () {
        $.ajax({
            type: "GET",
            url: "/BKlogout",
            success: function () {
                window.location.href = "http://localhost:8080/back-end/login.html";
            },
            error: function () {

            }
        });
    });
    // 渲染畫面
    fetch('/questionReportForm')
        .then(response => response.json())
        .then(data => {
            const tableBody = document.querySelector('.question-data');
            tableBody.innerHTML = '';
            data.forEach((item) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${item.id}</td>
                <td class="text-overflow">${item.questionContent || ""}</td>
                <td>${item.startTime || ""}</td>
                <td>${item.state === 0 ? '未解決' : '已解決'}</td>
            `;

				//客服人員處理問題
                const replyButton = document.createElement('button');
                replyButton.className = "myButton";
                replyButton.textContent = '處理訂單';
                replyButton.addEventListener('click', () =>{
                    Swal.fire({
                        title: '問題表單',
                        html: ` <span>會員問題：</span>
                                <p style="color: blue;">${item.questionContent}</p>
                                <div>我的回答:</div>`,
                        input: 'textarea',
                        inputPlaceholder: '在這裡輸入你的回答...',
                        showCancelButton: true,
                        confirmButtonText: '提交',
                        cancelButtonText: '取消',
                        preConfirm: (inputValue) => {
                            if (!inputValue) {
                                Swal.showValidationMessage('輸入不能為空')
                            }
                        }
                    })
                        .then((result) => {
                            if (result.isConfirmed) {
                                let replyContent = result.value;
                                Swal.fire({
                                    title: '確定要送出?',
                                    showCancelButton: true,
                                    confirmButtonText: '確定',
                                    cancelButtonText: '取消',
                                })
                                    .then((result) => {
                                        if (result.isConfirmed) {
                                            fetch(`/questionReportForm/${item.id}`, {
                                                method: 'Put',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                body: JSON.stringify({
                                                    replyContent: replyContent,
                                                    employeeId: employeeId
                                                })
                                            })
                                                .then(response => {
                                                    if (!response.ok) {
                                                        throw new Error('Network response was not ok');
                                                    }else
                                                    row.remove()
                                                })
                                                .catch((error) => {
                                                    console.error('Error:', error);
                                                });
                                        }
                                    });
                            }
                        });
                })
                row.appendChild(replyButton);
                tableBody.appendChild(row);

            });
        })
        .catch(error => console.error('Error:', error));
    	$("#logoutLink").click(function() {
        $.ajax({
            type: "GET",
            url: "/BKlogout",
            success: function() {
                window.location.href = "http://localhost:8080/back-end/login.html";
            },
            error: function() {}
    	    });
   		 });

</script>

</html>